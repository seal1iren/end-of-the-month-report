<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Педагоги Logika - підсумки місяця</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel = "stylesheet" href = "style.css">
<link rel="icon" type="image/x-icon" href="img/logo-logika.png">
</head>
<body>
  <div id="averages" class="averages-box"></div>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo">L</div>
        <div>
          <h1>Педагоги Logika</h1>
          <p class="lead">Аналіз роботи викладачів</p>
        </div>
      </div>

      <div class="controls">
        <div class="filters" role="tablist" aria-label="filters">
          <button class="btn active" data-filter="all">Усі</button>
          <button class="btn" data-filter="A">Категорія A</button>
          <button class="btn" data-filter="B">Категорія B</button>
        </div>

        <div class="sort">
          <label style="font-size:13px;color:var(--muted)">Сортувати за успішністю</label>
          <button class="btn" id="sortBtn" data-order="desc">За спаданням ↓</button>
        </div>
      </div>
    </header>

    <main>
      <div id="grid" class="grid" aria-live="polite"></div>
    </main>

    <footer>
      Автоматичне підсвічування: <span style="color:var(--green)">Відвали ≤ 5% → зелений</span> ·
      <span style="color:var(--yellow)">Успішність ≥ 80% → жовтий</span> ·
      <span style="color:var(--purple-2);color:var(--purple-2)">Конверсія ≥ 45% → фіолетовий</span>
    </footer>
  </div>

  <script>
    const teachers = [
  { name:"Стас Спіжавка", role:"Викладач онлайн та м.Чернівці", drops:4.48, success:83.68, conv:null, salary:true, transfer:79, kids:62, category:"A" },
  { name:"Надія Родімкіна", role:"Викладач онлайн та м.Сторожинець", drops:2.13, success:85.67, conv:null, salary:true, transfer:null, kids:41, category:"A" },
  { name:"Дар'я Борисенко", role:"Викладач м. Кам'янець-Подільський", drops:5.00, success:76.89, conv:33.33, salary:true, transfer:100, kids:20, category:"B" },
  { name:"Людмила Бешлей", role:"Викладач м.Чернівці", drops:0, success:78.83, conv:50.00, salary:true, transfer:null, kids:14, category:"B" },
  { name:"Микола Ремішевський", role:"Викладач м.Кам'янець-Подільський", drops:0, success:94.71, conv:75.00, salary:true, transfer:null, kids:28, category:"A" },
  { name:"Галина Сребніцька", role:"Викладач м.Чернівці", drops:2.70, success:85.92, conv:50.00, salary:true, transfer:null, kids:28, category:"A" },
  { name:"Владислава Торчинська", role:"Викладач м.Чернівці", drops:2.50, success:89.75, conv:20.83, salary:true, transfer:61.54, kids:41, category:"B" },
  { name:"Софія Стасюк", role:"Викладач м.Сторожинець", drops:8.11, success:93.66, conv:75.00, salary:true, transfer:null, kids:37, category:"B" },
  { name:"Настя Цугуй", role:"Викладач та клієнтський менеджер м. Сторожинець", drops:0, success:95.45, conv:null, salary:true, transfer:null, kids:0, category:"B" },
  { name:"Ірина Мікульська", role:"Викладач м.Чернівці та тьютор", drops:0, success:92.08, conv:null, salary:true, transfer:null, kids:15, category:"B" },
  { name:"Влад Длубік", role:"Викладач м.Чернівці", drops:7.14, success:80.84, conv:80.00, salary:true, transfer:null, kids:16, category:"B" },
  { name:"Олександр Цимбалюк", role:"Викладач м.Кам'янець-Подільський", drops:2.86, success:74.53, conv:null, salary:true, transfer:null, kids:40, category:"B" }
];

const imageMap = {
  "Стас Спіжавка": "img/спіжавка-стас.png",
  "Надія Родімкіна": "img/родімкіна-надія.png",
  "Дар'я Борисенко": "img/борисенко-дар'я.png",
  "Людмила Бешлей": "img/бешлей-людмила.png",
  "Микола Ремішевський": "img/ремішевський-микола.png",
  "Галина Сребніцька": "img/сребніцька-галина.png",
  "Владислава Торчинська": "img/торчинська-влада.png",
  "Софія Стасюк": "img/стасюк-софія.png",
  "Настя Цугуй": "img/цугуй-анастасія.png",
  "Ірина Мікульська": "img/ірина-мікульська.png",
  "Влад Длубік": "img/длубік-влад.png",
  "Олександр Цимбалюк": "img/цимбалюк-саша.png"
};

const thresholds = { drops:5.0, success:80.0, conv:45.0 };
const grid = document.getElementById('grid');

function hasDropsGood(d){ return (typeof d === 'number') && (d <= thresholds.drops); }
function hasSuccessGood(s){ return (typeof s === 'number') && (s >= thresholds.success); }
function hasConvGood(c){ return (typeof c === 'number') && (c >= thresholds.conv); }

function safeClass(name){
  return name.toLowerCase().replace(/[^a-zа-я0-9]+/g,'-').replace(/^-+|-+$/g,'');
}

function render(data){
  grid.innerHTML = '';
  data.forEach(t => {
    const passes = { drops: hasDropsGood(t.drops), success: hasSuccessGood(t.success), conv: hasConvGood(t.conv) };
    const fullPass = passes.drops && passes.success && passes.conv;

    const card = document.createElement('article');
    card.className = 'card ' + safeClass(t.name);

    // photo
    const photo = document.createElement('div'); photo.className = 'photo';
    const imgSrc = imageMap[t.name];
    if(imgSrc){
      photo.style.backgroundImage = `url("${imgSrc}")`;
      photo.style.backgroundPosition = 'center';
      photo.style.backgroundSize = 'cover';
    } else { photo.textContent = 'Фото'; }
    card.appendChild(photo);

    // meta
    const meta = document.createElement('div'); meta.className='meta';
    const name = document.createElement('div'); name.className='name'; name.textContent = t.name;
    const role = document.createElement('div'); role.className='role'; role.textContent = t.role;
    meta.appendChild(name); meta.appendChild(role);

    // metrics
    const metrics = document.createElement('div'); metrics.className='metrics';
    const mDrops = document.createElement('div'); mDrops.className='metric';
    mDrops.innerHTML = `<div class="label">Відвали</div><div class="value">${t.drops===null?'-':t.drops.toFixed(2)+'%'}</div>`;
    if(passes.drops) mDrops.style.borderLeft='4px solid var(--green)';
    const mSucc = document.createElement('div'); mSucc.className='metric';
    mSucc.innerHTML = `<div class="label">Успішність</div><div class="value">${t.success===null?'-':t.success.toFixed(2)+'%'}</div>`;
    if(passes.success) mSucc.style.borderLeft='4px solid var(--yellow)';
    const mConv = document.createElement('div'); mConv.className='metric';
    mConv.innerHTML = `<div class="label">Конверсія</div><div class="value">${t.conv===null?'-':t.conv.toFixed(2)+'%'}</div>`;
    if(passes.conv) mConv.style.borderLeft='4px solid var(--purple-2)';
    metrics.appendChild(mDrops); metrics.appendChild(mSucc); metrics.appendChild(mConv);
    meta.appendChild(metrics);
    card.appendChild(meta);

    // right column
    const right = document.createElement('div'); right.className='rightcol';
    const badges = document.createElement('div'); badges.className='badges';
    const bDrops = document.createElement('span'); bDrops.className = 'badge ' + (passes.drops ? 'b-green' : 'b-none');
    bDrops.textContent = 'Відвали ' + (t.drops===null?'-': (t.drops.toFixed(2)+'%'));
    const bSucc = document.createElement('span'); bSucc.className = 'badge ' + (passes.success ? 'b-yellow' : 'b-none');
    bSucc.textContent = 'Успішність ' + (t.success===null?'-': (t.success.toFixed(0)+'%'));
    const bConv = document.createElement('span'); bConv.className = 'badge ' + (passes.conv ? 'b-purple' : 'b-none');
    bConv.textContent = 'Конверсія ' + (t.conv===null?'-': (t.conv.toFixed(0)+'%'));
    badges.appendChild(bDrops); badges.appendChild(bSucc); badges.appendChild(bConv);
    right.appendChild(badges);

    const cat = document.createElement('div'); cat.className='category'; cat.textContent = 'Категорія ' + t.category; 
    right.appendChild(cat);

    const sal = document.createElement('div'); sal.style.fontSize='13px'; sal.style.color='var(--muted)'; 
    sal.textContent = t.salary ? 'Зарплату виплачено ✓' : 'Зарплату не виплачено';
    right.appendChild(sal);

    // transfer %
    const transfer = document.createElement('div'); transfer.style.fontSize='13px'; transfer.style.color='#0099ff';
    transfer.textContent = `Перевід: ${t.transfer ?? '-' }%`;
    right.appendChild(transfer);

    // kids
    const kids = document.createElement('div'); kids.style.fontSize='13px'; kids.style.color='#555';
    kids.textContent = `Кількість дітей: ${t.kids ?? '-'}`;
    right.appendChild(kids);

    card.appendChild(right);

    if(fullPass){
      card.style.boxShadow = '0 14px 40px rgba(45,45,66,0.12), 0 0 0 3px rgba(212,175,55,0.12) inset';
    }

    grid.appendChild(card);
  });
}

// sorting & filtering
let currentFilter = 'all', sortOrder='desc';
function getFiltered(){
  let out = teachers.slice();
  if(currentFilter === 'A' || currentFilter === 'B') out = out.filter(t => t.category === currentFilter);
  out.sort((a,b)=>{
    const av = (typeof a.success === 'number') ? a.success : -Infinity;
    const bv = (typeof b.success === 'number') ? b.success : -Infinity;
    return sortOrder==='desc' ? (bv-av) : (av-bv);
  });
  return out;
}

function calcAverages(data){
  const valid = f => typeof f === 'number' && !isNaN(f);
  const avg = arr => arr.reduce((a,b)=>a+b,0)/arr.length;

  const dropsArr = data.map(t=>t.drops).filter(valid);
  const successArr = data.map(t=>t.success).filter(valid);
  const convArr = data.map(t=>t.conv).filter(valid);
  const kidsArr = data.map(t=>t.kids).filter(valid);
  const transferArr = data.map(t=>t.transfer).filter(valid);

  return {
    drops: dropsArr.length ? avg(dropsArr) : null,
    success: successArr.length ? avg(successArr) : null,
    conv: convArr.length ? avg(convArr) : null,
    kids: kidsArr.length ? avg(kidsArr) : null,
    transfer: transferArr.length ? avg(transferArr) : null
  };
}

function showAverages(){
  const {drops, success, conv, kids, transfer} = calcAverages(getFiltered());
  const el = document.getElementById('averages');
  el.innerHTML = `
    <div><b>Середні показники команди</b></div>
    <div>Кількість дітей: 328</div>
    <div>Кількість відвалів: 12</div>
    <div>Відвали: 3.66%</div>
    <div>Конверсія: 54.84%</div>
    <div>Перевід: 64.44%</div>
    <div>Успішність: ${success ? success.toFixed(2)+'%' : '-'}</div>
  `;
}

function update(){ 
  render(getFiltered()); 
  showAverages(); 
}

document.querySelectorAll('.filters .btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.filters .btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = btn.getAttribute('data-filter');
    update();
  });
});

const sortBtn = document.getElementById('sortBtn');
sortBtn.addEventListener('click', ()=>{
  sortOrder = sortOrder === 'desc' ? 'asc' : 'desc';
  sortBtn.dataset.order = sortOrder;
  sortBtn.textContent = sortOrder === 'desc' ? 'За спаданням ↓' : 'За зростанням ↑';
  update();
});

update();

  </script>
</body>
</html>
